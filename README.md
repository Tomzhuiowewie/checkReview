# 项目说明

本项目为数字化场景评审与报告生成系统，集成了场景查重、AI分析、报告生成、向量存储等多项功能，适用于自动化评审、数据分析与文档输出等场景。

## 目录结构说明

- `batch_check.py`  
  实现批量场景查重功能，包含以下主要功能：
  - 加载场景数据并进行批量处理。
  - 使用向量化技术计算场景之间的相似度。
  - 提供查重结果的结构化输出，支持自定义阈值和过滤条件。

- `DBManger.py`  
  向量数据库管理模块，主要功能包括：
  - 集成嵌入模型（如 SentenceTransformers）和摘要模型。
  - 提供场景向量的增删改查操作。
  - 使用 ChromaDB 作为底层存储，支持高效的向量检索。

- `dynamic_run.py`  
  动态查重算法实现，主要功能包括：
  - 支持动态调整查重权重和阈值。
  - 提供灵活的查重逻辑，适配不同场景需求。
  - 输出查重结果的详细分析。

- `inter_pack.py`  
  自定义大模型（LLM）调用接口封装，主要功能包括：
  - 提供统一的接口与大模型交互。
  - 支持多种模型调用方式（如 OpenAI API、本地模型）。
  - 便于扩展和维护模型相关逻辑。

- `llm_client.py`  
  LLM 客户端模块，主要功能包括：
  - 构建与大模型交互的 prompt（提示词）。
  - 实现链式调用，支持复杂任务的分步执行。
  - 处理大模型返回的结果并进行解析。

- `mysql_info.py`  
  数据库配置与连接管理模块，主要功能包括：
  - 从 `config.ini` 文件中读取数据库配置信息。
  - 提供数据库连接池管理。
  - 提供常用的数据库操作工具函数。

- `plot.py`  
  数据可视化模块，主要功能包括：
  - 生成图表（如柱状图、折线图）以展示分析结果。
  - 支持将图表保存为图片文件，用于报告生成。

- `prompts.py`  
  提示词模板存储模块，主要功能包括：
  - 提供多种场景下的大模型提示词模板。
  - 支持动态生成 prompt，适配不同任务需求。

- `report_gen.py`  
  报告生成模块，主要功能包括：
  - 根据模板和数据生成 Word 格式的报告。
  - 支持插入图表、表格和文本内容。
  - 提供灵活的模板配置，适配不同报告需求。

- `review_agent.py`  
  评审代理模块，主要功能包括：
  - 集成大模型进行场景的自动化评审。
  - 输出结构化的评分和改进建议。
  - 支持多种评审标准的自定义配置。

- `run.py`  
  项目运行入口脚本，主要功能包括：
  - 提供命令行接口，便于快速启动和测试项目功能。
  - 调用核心模块执行查重、评审和报告生成任务。

- `server.py`  
  FastAPI 服务主入口，主要功能包括：
  - 定义 RESTful API 接口，支持查重、评审、报告生成等功能。
  - 提供文件上传和下载接口。
  - 集成资源监控功能，记录接口请求期间的 CPU、内存、GPU 使用情况。

- `test.py`  
  测试脚本，主要功能包括：
  - 提供单元测试和集成测试用例。
  - 验证各模块的功能和接口是否正常工作。

- `vector_storage.py`  
  向量存储工具模块，主要功能包括：
  - 提供向量化处理的工具函数。
  - 支持向量的存储、检索和更新操作。

- `chroma_db/`  
  ChromaDB 向量数据库文件夹，存储场景向量数据，支持高效的相似度检索。

- `input/`  
  输入文件夹，包含以下内容：
  - `config.ini`：配置文件，包含数据库、模型路径、API Key 等信息。
  - 报告模板：用于生成报告的 Word 模板文件。
  - 图片文件：用于报告生成的图表或其他图片资源。

- `models/`  
  本地模型文件夹，存放以下内容：
  - 嵌入模型：用于场景向量化的模型文件。
  - 摘要模型：用于生成场景摘要的模型文件。

- `output/`  
  输出文件夹，存放以下内容：
  - 生成的报告文件。
  - 数据分析结果文件。
  - 可视化图表文件。

- `server.log`  
  服务运行日志文件，记录服务启动、接口调用、错误信息等日志。

- `__pycache__/`  
  Python 编译缓存文件夹，存放 `.pyc` 文件。

## 配置文件

- `input/config.ini`  
  包含数据库、模型、报告模板等配置信息。  
  主要字段包括：
  - 数据库连接信息（如主机、端口、用户名、密码）。
  - 模型路径配置。
  - API Key 配置。
  - 报告模板路径。

## 主要依赖

- FastAPI：用于构建 Web 服务。
- Pydantic：用于数据验证和模型定义。
- ChromaDB：用于向量存储和检索。
- SentenceTransformers：用于场景向量化。
- Transformers：用于调用大模型。
- LangChain：用于构建复杂的 LLM 调用链。
- OpenAI/自定义大模型 API：用于场景分析和评审。
- psutil、pynvml：用于资源监控。

## 主要功能

1. **场景查重**：支持自定义权重、阈值的查重算法，返回相似场景。
2. **AI 评审**：集成大模型自动化评审场景，输出结构化打分与建议。
3. **报告生成**：根据模板与数据自动生成 Word 报告。
4. **向量存储**：场景文本向量化后存储于本地 ChromaDB，支持高效检索。
5. **资源监控**：接口请求期间自动采集 CPU、内存、GPU 峰值。
6. **文件上传**：支持 base64 文件上传与解压。

## 启动方式

1. 安装依赖  
   ```sh
   pip install -r requirements.txt
   ```

2. 启动服务  
   ```sh
   python server.py
   ```

## 备注

- 请根据 `input/config.ini` 配置数据库、模型路径及 API Key。
- 详细接口说明请参考 [server.py](server.py) 文件中的 FastAPI 路由定义。